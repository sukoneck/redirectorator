<!DOCTYPE html>
<html>
<head>
    <title>Service Notice</title>
    <script>
        async function loadConfig() {
            try {
                const response = await fetch('config.json');
                return await response.json();
            } catch (error) {
                console.error('Failed to load config:', error);
                return { routes: [] };
            }
        }

        async function handleRequest() {
            const config = await loadConfig();
            const url = new URL(window.location.href);
            const host = url.hostname;
            const path = url.pathname;

            const route = config.routes
                .sort((a, b) => b.path.length - a.path.length)
                .find(r => (r.host === host || r.host === '*') && path.startsWith(r.path));

            if (!route) {
                document.getElementById('message').textContent = 'Unknown service';
                return;
            }

            if (route.type === 'api') {
                document.body.innerHTML = JSON.stringify({
                    status: route.status || 410,
                    message: route.message
                });
                return;
            }

            document.getElementById('message').textContent = route.message;
            if (route.redirectUrl) {
                const seconds = config.redirectDelay || 5;
                let count = seconds;
                document.getElementById('message').textContent += ` Redirecting in ${count} seconds...`;
                const interval = setInterval(() => {
                    count--;
                    if (count <= 0) {
                        clearInterval(interval);
                        window.location.href = route.redirectUrl;
                    } else {
                        document.getElementById('message').textContent =
                            `${route.message} Redirecting in ${count} seconds...`;
                    }
                }, 1000);
            }
        }
    </script>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 600px;
            margin: 48px auto;
            padding: 20px;
            line-height: 1.6;
        }
        .notice {
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
    </style>
</head>
<body onload="handleRequest()">
    <div class="notice">
        <h1>Service Notice</h1>
        <p id="message"></p>
    </div>
</body>
</html>
